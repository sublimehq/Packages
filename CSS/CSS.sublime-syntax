%YAML 1.2
---
# https://www.sublimetext.com/docs/syntax.html
# Derived from https://github.com/i-akhmadullin/Sublime-CSS3
name: CSS
scope: source.css
version: 2

file_extensions:
  - css
  - css.erb
  - css.liquid

###############################################################################

variables:
  # Basic tokens
  # https://www.w3.org/TR/css3-selectors/#lex
  unicode: \\\h{1,6}[ \t\n\f]?
  escape: (?:{{unicode}}|\\[^\n\f\h])
  nmstart: (?:[_[:alpha:][:^ascii:]]|{{escape}})
  nmchar: (?:[-_[:alnum:][:^ascii:]]|{{escape}})

  # Identifier Break
  # The proper pattern would be (?!{{nmchar}}), but its impact on performance
  # is just too high, thus several optimizations are applied.
  # 1. Use positive lookahead with \Z to handle `eof`
  # 2. Breaks are ascii characters other than denoted by {{nmchar}}.
  # 3. Assume unicode or escape character if backslash is matched, instead of
  #    matching (?!{{escape}}) which also effects performance negative.
  break: (?=[[^-_[:alnum:]\\]&&[[:ascii:]]]|\Z)

  # Identifiers  
  # https://www.w3.org/TR/css-syntax-3/#typedef-ident-token
  ident: (?:--{{name}}|-?{{nmstart}}{{nmchar}}*)
  # https://www.w3.org/TR/css3-selectors/#lex
  name: '{{nmchar}}+'

  # Types
  # https://www.w3.org/TR/css3-values/#numeric-types
  # https://www.w3.org/TR/css-syntax-3/#number-token-diagram
  integer: ([-+]?)(\d+)
  float: ([-+]?)(\d*(\.)\d+(?:[eE][-+]?\d+)?|\d+[eE][-+]?\d+)

  # Units
  # https://www.w3.org/TR/css3-values/#lengths
  font_relative_lengths: (?i:em|ex|ch|rem)
  viewport_percentage_lengths: (?i:vw|vh|vmin|vmax)
  absolute_lengths: (?i:cm|mm|q|in|pt|pc|px|fr)
  angle_units: (?i:deg|grad|rad|turn)
  duration_units: (?i:s|ms)
  frequency_units: (?i:Hz|kHz)
  resolution_units: (?i:dpi|dpcm|dppx)

  # Combinators
  # https://drafts.csswg.org/selectors-4/#combinators
  combinators: (?:>{1,3}|[~+]|\|{2})

  vendor_prefix: -(?:webkit|moz|ms|o)-

  # Custom Element Names
  # https://html.spec.whatwg.org/multipage/custom-elements.html#custom-elements-core-concepts
  custom_element_tags: \b[a-z]{{custom_element_chars}}*-{{custom_element_chars}}*{{break}}
  # Note: Excludes `.` as it is used to identify attribute access
  custom_element_chars: |-
    (?x:
      [-_a-z0-9\x{00B7}]
    | [\x{00C0}-\x{00D6}]
    | [\x{00D8}-\x{00F6}]
    | [\x{00F8}-\x{02FF}]
    | [\x{0300}-\x{037D}]
    | [\x{037F}-\x{1FFF}]
    | [\x{200C}-\x{200D}]
    | [\x{203F}-\x{2040}]
    | [\x{2070}-\x{218F}]
    | [\x{2C00}-\x{2FEF}]
    | [\x{3001}-\x{D7FF}]
    | [\x{F900}-\x{FDCF}]
    | [\x{FDF0}-\x{FFFD}]
    | [\x{10000}-\x{EFFFF}]
    )

  # HTML tags
  # https://developer.mozilla.org/en-US/docs/Web/HTML/Element
  # Note: Sections are sorted by expected frequency.
  html_tags:  |-
    (?x:
      {{html_inline_tags}}
    | {{html_text_tags}}
    | {{html_section_tags}}
    | {{html_table_tags}}
    | {{html_embedded_tags}}
    | {{html_forms_tags}}
    | {{html_media_tags}}
    | {{html_interactive_tags}}
    | {{html_script_tags}}
    | {{html_web_tags}}
    | {{html_markup_tags}}
    | {{html_header_tags}}
    | {{html_root_tags}}
    | {{html_deprecated_tags}}
    )

  html_root_tags: |-
    \b(?xi: html | body ){{break}}

  html_header_tags: |-
    \b(?xi: base | head | link | meta | script | style | title ){{break}}

  html_section_tags: |-
    \b(?xi:
        address | article | aside | footer | header | h1 | h2 | h3 | h4 | h5 | h6
      | hgroup | main | nav | section
    ){{break}}

  html_text_tags: |-
    \b(?xi:
        blockquote | cite | dd | dt | dl | div | figcaption | figure | hr | li
      | ol | p | pre | ul
    ){{break}}

  html_inline_tags: |-
    \b(?xi:
        a | abbr | b | bdi | bdo | br | code | data | time | dfn | em | i | kbd
      | mark | q | rb | ruby | rp | rt | rtc | s | samp | small | span | strong
      | sub | sup | u | var | wbr
    ){{break}}

  html_media_tags: |-
    \b(?xi: area | audio | source | img | map | track | video ){{break}}

  html_embedded_tags: |-
    \b(?xi: embed | iframe | object | param | picture | source ){{break}}

  html_script_tags: |-
    \b(?xi: canvas | noscript | script ){{break}}

  html_markup_tags: |-
    \b(?xi: del | ins ){{break}}

  html_table_tags: |-
    \b(?xi:
        caption | col | colgroup | table | tbody | tr | td | tfoot | th | thead
    ){{break}}

  html_forms_tags: |-
    \b(?xi:
        button | datalist | option | fieldset | label | form | input | legend
      | meter | optgroup | select | output | progress | textarea
    ){{break}}

  html_interactive_tags: |-
    \b(?xi: details | dialog | menu | summary ){{break}}

  html_web_tags: |-
    \b(?xi: slot | template ){{break}}

  html_deprecated_tags: |-
    \b(?xi:
        acronym | applet | basefont | bgsound | big | blink | center | command
      | content | dir | element | font | frame | frameset | image | isindex
      | keygen | listing | marquee | menuitem | multicol | nextid | nobr
      | noembed | noframes | plaintext | shadow | spacer | strike | tt | xmp
    ){{break}}

  # SVG tag names
  # maintained from previous CSS.sublime-syntax
  svg_tags: |-
    \b(?xi:
        circle | clipPath | defs | ellipse | eventsource | filter | foreignObject
      | g | glyph | glyphRef | line | linearGradient | marker | mask | path
      | pattern | polygon | polyline | radialGradient | rect | stop | svg
      | switch | symbol | text | textPath | tref | tspan | use
      # custom element like tags reserved for SVG/MathML
      | annotation-xml | color-profile | missing-glyph
      | font-face(?: -src | -uri | -format | -name )?
    ){{break}}

  # Predefined Color Values (Standard Set)
  # https://www.w3.org/TR/CSS22/syndata.html#color-units
  standard_colors: |-
    \b(?xi:
        aqua | black | blue | fuchsia | gray | green | lime | maroon | navy
      | olive | orange | purple | red | silver | teal | white | yellow
    ){{break}}

  # Predefined Color Values (Extended Set)
  # https://www.w3.org/TR/css3-color/#svg-color
  extended_colors: |-
    \b(?xi:
        aliceblue | antiquewhite | aquamarine | azure | beige | bisque
      | blanchedalmond | blueviolet | brown | burlywood | cadetblue | chartreuse
      | chocolate | coral | cornflowerblue | cornsilk | crimson | cyan | darkblue
      | darkcyan | darkgoldenrod | darkgray | darkgreen | darkgrey | darkkhaki
      | darkmagenta | darkolivegreen | darkorange | darkorchid | darkred
      | darksalmon | darkseagreen | darkslateblue | darkslategray | darkslategrey
      | darkturquoise | darkviolet | deeppink | deepskyblue | dimgray | dimgrey
      | dodgerblue | firebrick | floralwhite | forestgreen | gainsboro
      | ghostwhite | gold | goldenrod | greenyellow | grey | honeydew | hotpink
      | indianred | indigo | ivory | khaki | lavender | lavenderblush | lawngreen
      | lemonchiffon | lightblue | lightcoral | lightcyan | lightgoldenrodyellow
      | lightgray | lightgreen | lightgrey | lightpink | lightsalmon
      | lightseagreen | lightskyblue | lightslategray | lightslategrey
      | lightsteelblue | lightyellow | limegreen | linen | magenta
      | mediumaquamarine | mediumblue | mediumorchid | mediumpurple
      | mediumseagreen | mediumslateblue | mediumspringgreen | mediumturquoise
      | mediumvioletred | midnightblue | mintcream | mistyrose | moccasin
      | navajowhite | oldlace | olivedrab | orangered | orchid | palegoldenrod
      | palegreen | paleturquoise | palevioletred | papayawhip | peachpuff | peru
      | pink | plum | powderblue | rebeccapurple | rosybrown | royalblue
      | saddlebrown | salmon | sandybrown | seagreen | seashell | sienna
      | skyblue | slateblue | slategray | slategrey | snow | springgreen
      | steelblue | tan | thistle | tomato | turquoise | violet | wheat
      | whitesmoke | yellowgreen
    ){{break}}

  # Illegal Counter Style Definition Names
  # https://drafts.csswg.org/css-counter-styles-3/#typedef-counter-style-name
  counter_style_illegal_names: |-
    \b(?xi: decimal | disc | inherit | initial | none | unset ){{break}}

  # Predefined Counter Styles
  # https://drafts.csswg.org/css-counter-styles-3/#predefined-counters
  counter_style_names: |-
    \b(?xi:
        none | arabic-indic | armenian | bengali | cambodian | circle
      | cjk-decimal | cjk-earthly-branch | cjk-heavenly-stem | decimal-leading-zero
      | decimal | devanagari | disclosure-closed | disclosure-open | disc
      | ethiopic-numeric | georgian | gujarati | gurmukhi | hebrew
      | hiragana-iroha | hiragana | japanese-formal | japanese-informal
      | kannada | katakana-iroha | katakana | khmer
      | korean-hangul-formal | korean-hanja-formal | korean-hanja-informal | lao
      | lower-alpha | lower-armenian | lower-greek | lower-latin | lower-roman
      | malayalam | mongolian | myanmar | oriya | persian
      | simp-chinese-formal | simp-chinese-informal
      | square | tamil | telugu | thai | tibetan
      | trad-chinese-formal | trad-chinese-informal
      | upper-alpha | upper-armenian | upper-latin | upper-roman
    ){{break}}

  # Predefined Counter Speak As Property Constants
  # https://drafts.csswg.org/css-counter-styles-3/#counter-style-speak-as
  counter_speak_as_constants: |-
    \b(?xi: auto | bullets | numbers | words | spell-out ){{break}}

  # Predefined Counter Style System Constants
  # https://drafts.csswg.org/css-counter-styles-3/#counter-style-system
  counter_system_constants: |-
    \b(?xi: cyclic | numeric | alphabetic | symbolic | additive | fixed ){{break}}

  # Generic Font Families
  # https://www.w3.org/TR/CSS22/fonts.html#generic-font-families
  font_family_constants: |-
    \b(?xi: sans-serif | serif | monospace | fantasy | cursive | system-ui){{break}}

  # Property names are sorted by popularity in descending order.
  # Popularity data taken from https://www.chromestatus.com/metrics/css/popularity
  property_names: |-
    \b(?xi:
        display | width | background-color | height | position | font-family
      | font-weight | top | opacity | cursor | background-image | right
      | visibility | box-sizing | user-select | left | float | margin-left
      | margin-top | line-height | padding-left | z-index | margin-bottom
      | margin-right | margin | vertical-align | padding-top | white-space
      | border-radius | padding-bottom | padding-right | padding | bottom | clear
      | max-width | box-shadow | content | border-color | min-height | min-width
      | font-style | border-width | border-collapse | background-size
      | text-overflow | max-height | text-transform | text-shadow | text-indent
      | border-style | overflow-y | list-style-type | word-wrap | border-spacing
      | appearance | zoom | overflow-x | border-top-left-radius
      | border-bottom-left-radius | border-top-color | pointer-events
      | border-bottom-color | align-items | justify-content | letter-spacing
      | border-top-right-radius | border-bottom-right-radius | border-right-width
      | font-smoothing | border-bottom-width | border-right-color | direction
      | border-top-width | src | border-left-color | border-left-width
      | tap-highlight-color | table-layout | background-clip | word-break
      | transform-origin | resize | filter | backface-visibility | text-rendering
      | box-orient | transition-property | transition-duration | word-spacing
      | quotes | outline-offset | animation-timing-function | animation-duration
      | animation-name | transition-timing-function | border-bottom-style
      | border-bottom | transition-delay | transition | unicode-bidi
      | border-top-style | border-top | unicode-range | list-style-position
      | orphans | outline-width | line-clamp | order | flex-direction | box-pack
      | animation-fill-mode | outline-color | list-style-image | list-style
      | touch-action | flex-grow | border-left-style | border-left
      | animation-iteration-count | page-break-inside | box-flex | box-align
      | page-break-after | animation-delay | widows | border-right-style
      | border-right | flex-align | outline-style | outline | background-origin
      | animation-direction | fill-opacity | background-attachment | flex-wrap
      | transform-style | overflow-wrap | animation-play-state | animation
      | will-change | box-ordinal-group | image-rendering | marks | mask-image
      | flex-flow | background-position-y | stroke-width | background-position-x
      | background-position | background-blend-mode | flex-shrink | flex-basis
      | flex-order | flex-item-align | flex-line-pack | flex-negative | flex-pack
      | flex-positive | flex-preferred-size | flex | user-drag | font-stretch
      | column-count | empty-cells | align-self | caption-side | mask-size
      | column-gap | mask-repeat | box-direction | font-feature-settings
      | mask-position | align-content | object-fit | columns | text-fill-color
      | clip-path | stop-color | font-kerning | page-break-before
      | stroke-dasharray | size | fill-rule | border-image-slice | column-width
      | break-inside | column-break-before | border-image-width| stroke-dashoffset
      | border-image-repeat | border-image-outset | line-break | stroke-linejoin
      | stroke-linecap | stroke-miterlimit | stroke-opacity | stroke
      | shape-rendering | border-image-source | border-image | border | tab-size
      | writing-mode | perspective-origin-y | perspective-origin-x
      | perspective-origin | perspective | text-align-last | text-align
      | clip-rule | clip | text-anchor | column-rule-color | box-decoration-break
      | column-fill | fill | column-rule-style | mix-blend-mode
      | text-emphasis-color | baseline-shift | dominant-baseline | page
      | alignment-baseline | column-rule-width | column-rule | break-after
      | font-variant-ligatures | transform-origin-y | transform-origin-x
      | transform | object-position | break-before | column-span | isolation
      | shape-outside | all | color-interpolation-filters | marker | marker-end
      | marker-start | marker-mid | color-rendering | color-interpolation
      | background-repeat-x | background-repeat-y | background-repeat
      | background | mask-type | flood-color | flood-opacity | text-orientation
      | mask-composite | text-emphasis-style | paint-order | lighting-color
      | shape-margin | text-emphasis-position | text-emphasis
      | shape-image-threshold | mask-clip | mask-origin | mask | font-variant-caps
      | font-variant-alternates | font-variant-east-asian | font-variant-numeric
      | font-variant-position | font-variant | font-size-adjust | font-size
      | font-language-override | font-display | font-synthesis | font
      | line-box-contain | text-justify | text-decoration-color
      | text-decoration-style | text-decoration-line | text-decoration
      | text-underline-position | grid-template-rows | grid-template-columns
      | grid-template-areas | grid-template | rotate | scale | translate
      | scroll-behavior | grid-column-start | grid-column-end | grid-column-gap
      | grid-row-start | grid-row-end | grid-auto-rows | grid-area
      | grid-auto-flow | grid-auto-columns | image-orientation | hyphens
      | overflow-scrolling | overflow | color-profile | kerning | nbsp-mode
      | color | image-resolution | grid-row-gap | grid-row | grid-column
      | blend-mode | azimuth | pause-after | pause-before | pause | pitch-range
      | pitch | text-height | system | negative | prefix | suffix | range | pad
      | fallback | additive-symbols | symbols | speak-as | speak | grid-gap | grid
    ){{break}}

  property_values: |-
    \b(?xi:
        absolute|active|add
      | all(-(petite|small)-caps|-scroll)?
      | alpha(betic)?
      | alternate(-reverse)?
      | always|annotation|antialiased|at
      | auto(hiding-scrollbar|-flow)?
      | avoid(-column|-page|-region)?
      | background(-color|-image|-position|-size)?
      | backwards|balance|baseline|below|bevel|bicubic|bidi-override|blink
      | block(-line-height)?
      | blur
      | bold(er)?
      | border(-bottom|-left|-right|-top)?-(color|radius|width|style)
      | border-(bottom|top)-(left|right)-radius
      | border-image(-outset|-repeat|-slice|-source|-width)?
      | border(-bottom|-left|-right|-top|-collapse|-spacing|-box)?
      | both|bottom
      | box(-shadow)?
      | break-(all|word)
      | brightness
      | butt(on)?
      | capitalize
      | cent(er|ral)
      | char(acter-variant)?
      | cjk-ideographic|clip|clone|close-quote
      | closest-(corner|side)
      | col-resize|collapse
      | color(-stop|-burn|-dodge)?
      | column((-count|-gap|-reverse|-rule(-color|-width)?|-width)|s)?
      | common-ligatures|condensed|consider-shifts|contain
      | content(-box|s)?
      | contextual|contrast|cover
      | crisp(-e|E)dges
      | crop
      | cross(hair)?
      | da(rken|shed)
      | default|dense|diagonal-fractions|difference|disabled
      | discretionary-ligatures|disregard-shifts
      | distribute(-all-lines|-letter|-space)?
      | dotted|double|drop-shadow
      | (nwse|nesw|ns|ew|sw|se|nw|ne|w|s|e|n)-resize
      | ease(-in-out|-in|-out)?
      | element|ellipsis|embed|end|EndColorStr|evenodd
      | exclu(de(-ruby)?|sion)
      | expanded
      | (extra|semi|ultra)-(condensed|expanded)
      | farthest-(corner|side)?
      | fill(-box|-opacity)?
      | filter|first|fixed|flat
      | fit-content
      | flex((-basis|-end|-grow|-shrink|-start)|box)?
      | flip|flood-color
      | font(-size(-adjust)?|-stretch|-weight)?
      | forwards
      | from(-image)?
      | full-width|geometricPrecision|glyphs|gradient|grayscale
      | grid(-height)?
      | groove|hand|hanging|hard-light|height|help|hidden|hide
      | historical-(forms|ligatures)
      | horizontal(-tb)?
      | hue
      | ideograph(-alpha|-numeric|-parenthesis|-space|ic)
      | inactive|include-ruby|infinite|inherit|initial
      | inline(-block|-box|-flex(box)?|-line-height|-table)?
      | inset|inside
      | inter(-ideograph|-word|sect)
      | invert|isolat(e|ion)|italic
      | jis(04|78|83|90)
      | justify(-all)?
      | keep-all
      | large[r]?
      | landscape|ledger|legal|letter|A[3-5]|(JIS-)?B[4-5]|portrait
      | last|left|letter-spacing
      | light(e[nr]|ing-color)
      | line(-edge|-height|-through)?
      | linear(-gradient|RGB)?
      | lining-nums|list-item|local|loose|lowercase|lr-tb|ltr
      | lumin(osity|ance)|manual
      | margin(-bottom|-box|-left|-right|-top)?
      | marker(-offset|s)?
      | mathematical
      | max-(content|height|lines|size|width)
      | medium|middle
      | min-(content|height|width)
      | miter|mixed|move|multiply|newspaper
      | no-(change|clip|(close|open)-quote|(common|discretionary|historical)-ligatures|contextual|drop|repeat)
      | none|nonzero|normal|not-allowed|nowrap|oblique
      | offset(-after|-before|-end|-start)?
      | oldstyle-nums|opacity|open-quote
      | optimize(Legibility|Precision|Quality|Speed)
      | order|ordinal|ornaments
      | outline(-color|-offset|-width)?
      | outset|outside|over(line|-edge|lay)
      | padding(-bottom|-box|-left|-right|-top)?
      | page|painted|paused
      | perspective-origin
      | petite-caps|pixelated|pointer
      | pre(-line|-wrap)?
      | preserve-3d
      | progid:DXImageTransform.Microsoft.(Alpha|Blur|dropshadow|gradient|Shadow)
      | progress
      | proportional-(nums|width)
      | radial-gradient|recto|region|relative
      | repeat(-[xy])?
      | repeating-(linear|radial)-gradient
      | replaced|reset-size|reverse|ridge|right
      | round
      | row(-resize|-reverse)?
      | run-in
      | ruby(-base|-text)?(-container)?
      | rtl|running|saturat(e|ion)|screen
      | safe
      | scroll(-position|bar)?
      | separate|sepia
      | scale-down
      | shape-(image-threshold|margin|outside)
      | show
      | sideways(-lr|-rl)?
      | simplified
      | slashed-zero|slice
      | small(-caps|er)?
      | smooth|snap|solid|soft-light
      | space(-around|-between|-evenly)?
      | span|sRGB
      | stack(ed-fractions)?
      | start(ColorStr)?
      | static
      | step-(end|start)
      | sticky
      | stop-(color|opacity)
      | stretch|strict
      | stroke(-box|-dash(array|offset)|-miterlimit|-opacity|-width)?
      | style(set)?
      | stylistic
      | sub(grid|pixel-antialiased|tract)?
      | super|swash
      | table(-caption|-cell|(-column|-footer|-header|-row)-group|-column|-row)?
      | tabular-nums|tb-rl
      | text((-bottom|-(decoration|emphasis)-color|-indent|-(over|under|after|before)-edge|-shadow|-size(-adjust)?|-top)|field)?
      | thi(ck|n)
      | titling-ca(ps|se)
      | to[p]?
      | touch|traditional
      | transform(-origin)?
      | under(-edge|line)?
      | unicase|unsafe|unset|uppercase|upright
      | use-(glyph-orientation|script)
      | verso
      | vertical(-align|-ideographic|-lr|-rl|-text)?
      | view-box
      | viewport-fill(-opacity)?
      | visibility
      | visible(Fill|Painted|Stroke)?
      | wait|wavy|weight|whitespace|width|word-spacing
      | wrap(-reverse)?
      | x{1,2}-(large|small)
      | z-index|zero
      | zoom(-in|-out)?
    ){{break}}

###############################################################################

contexts:

  main:
    - include: comments
    - include: selectors
    - include: at-rules
    - include: property-lists
    - include: rule-terminators

###[ COMMENTS ]################################################################

  comments:
    # empty block comment
    - match: (/\*+)(\*/)
      scope: comment.block.css
      captures:
         1: punctuation.definition.comment.begin.css
         2: punctuation.definition.comment.end.css
    # normal block comment
    - match: /\*+
      scope: punctuation.definition.comment.begin.css
      push: comments-content

  comments-content:
    - meta_scope: comment.block.css
    - match: \*+/
      scope: punctuation.definition.comment.end.css
      pop: 1
    - match: ^\s*(\*)(?!/)
      captures:
        1: punctuation.definition.comment.css

###[ AT RULES ]################################################################

  at-rules:
    - include: at-charset
    - include: at-counter-style
    - include: at-custom-media
    - include: at-document
    - include: at-font-face
    - include: at-import
    - include: at-keyframes
    - include: at-media
    - include: at-namespace
    - include: at-page
    - include: at-page-margin
    - include: at-supports
    - include: at-other

  # @charset
  # https://www.w3.org/TR/css-syntax-3/#at-ruledef-charset
  at-charset:
    - match: (@)(?i:charset){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-charset-content

  at-charset-content:
    - meta_scope: meta.at-rule.charset.css
    - include: quoted-strings
    - include: at-rule-end

  # @counter-style
  # https://drafts.csswg.org/css-counter-styles-3/#the-counter-style-rule
  at-counter-style:
    - match: (@)(?i:counter-style){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-counter-style-content

  at-counter-style-content:
    - meta_scope: meta.at-rule.counter-style.css
    - match: '{{counter_style_illegal_names}}'
      scope: invalid.illegal.counter-style-name.css
    - match: '{{ident}}'
      scope: entity.other.counter-style-name.css
    - include: rule-list
    - include: at-rule-end

  # @custom-media
  # https://??
  at-custom-media:
    - match: (@)(?i:custom-media){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push:
        - at-custom-media-content
        - at-custom-media-identifier

  at-custom-media-identifier:
    - match: '--{{name}}'
      scope: entity.other.custom-media.css
      pop: 1
    - include: comments
    - include: else-pop

  at-custom-media-content:
    - meta_scope: meta.at-rule.custom-media.css
    - include: media-query-content
    - include: at-rule-end

  # @document
  # https://www.w3.org/TR/2012/WD-css3-conditional-20120911/#at-document
  at-document:
    - match: (@)(?i:document){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-document-content

  at-document-content:
    - meta_scope: meta.at-rule.document.css
    - include: comma-delimiters
    - include: url-functions
    - include: url-prefix-functions
    - include: domain-functions
    - include: regexp-functions
    - include: at-block
    - include: at-rule-end

  # @font-face
  # https://www.w3.org/TR/css-fonts-4/#at-font-face-rule
  at-font-face:
    - match: (@)(?i:font-face){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-font-face-content

  at-font-face-content:
    - meta_scope: meta.at-rule.font-face.css
    - include: rule-list
    - include: at-rule-end

  # @import
  # https://www.w3.org/TR/css-cascade-4/#at-ruledef-import
  at-import:
    - match: (@)(?i:import){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-import-content

  at-import-content:
    - meta_scope: meta.at-rule.import.css
    - include: quoted-strings
    - include: url-functions
    - include: media-query-content
    - include: at-rule-end

  # @keyframes
  # https://www.w3.org/TR/css3-animations/#at-ruledef-keyframes
  at-keyframes:
    - match: (@)(?i:keyframes){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-keyframe-content

  at-keyframe-content:
    - meta_scope: meta.at-rule.keyframe.css
    - include: comma-delimiters
    - include: at-keyframe-block
    - include: at-keyframe-names
    - include: at-rule-end

  at-keyframe-names:
    - match: '{{ident}}'
      scope: entity.other.animation-name.css

  at-keyframe-block:
    - match: \{
      scope: punctuation.section.block.begin.css
      push: at-keyframe-block-content

  at-keyframe-block-content:
    - meta_scope: meta.block.css
    - include: block-end2
    - match: \b(?i:from|to){{break}}
      scope: keyword.keyframe-selector.css
    - include: comma-delimiters
    - include: numeric-constants
    - include: main

  # @media
  # https://drafts.csswg.org/css-conditional-3/#at-ruledef-media
  at-media:
    - match: (@)(?i:media){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-media-content

  at-media-content:
    - meta_scope: meta.at-rule.media.css
    - include: media-query-content
    - include: at-block
    - include: at-rule-end

  # @namespace
  # https://www.w3.org/TR/css3-namespace/
  at-namespace:
    - match: (@)(?i:namespace){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push:
        - at-namespace-content
        - at-namespace-identifier

  at-namespace-identifier:
    - match: '{{ident}}(?!{{nmchar}}|\()'
      scope: entity.other.namespace-prefix.css
      pop: 1
    - include: comments
    - include: else-pop

  at-namespace-content:
    - meta_scope: meta.at-rule.namespace.css
    - include: quoted-strings
    - include: url-functions
    - include: at-rule-end

  # @page
  # https://www.w3.org/TR/css3-page/#at-ruledef-page
  at-page:
    - match: (@)(?i:page){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-page-content

  at-page-content:
    - meta_scope: meta.at-rule.page.css
    - match: (:)(?i:blank|first|left|right){{break}}
      captures:
        0: entity.other.pseudo-class.css
        1: punctuation.definition.entity.css
    - match: (:){{name}}
      captures:
        # 0: invalid.illegal.pseudo-class.css
        1: punctuation.definition.entity.css
    - match: '{{ident}}'
      scope: entity.other.page-name.css
    - include: comma-delimiters
    - include: at-page-block
    - include: at-rule-end

  at-page-block:
    - match: \{
      scope: punctuation.section.block.begin.css
      push: at-page-block-content

  at-page-block-content:
    - meta_scope: meta.property-list.css meta.block.css
    - include: block-end2
    - include: at-page-margin
    - include: at-other
    - include: property-lists
    - include: rule-list-body

  # @top-center, ...
  # https://www.w3.org/TR/css-page-3/#margin-at-rule
  at-page-margin:
    - match: |-
        (?xi)
        (@)
        ( top-left-corner
        | top-left
        | top-center
        | top-right
        | top-right-corner
        | bottom-left-corner
        | bottom-left
        | bottom-center
        | bottom-right
        | bottom-right-corner
        | left-top
        | left-middle
        | left-bottom
        | right-top
        | right-middle
        | right-bottom
        ){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-page-margin-content

  at-page-margin-content:
    - meta_scope: meta.at-rule.margin.css
    - include: at-page-block
    - include: at-rule-end

  # @supports
  # https://drafts.csswg.org/css-conditional-3/#at-supports
  at-supports:
    - match: (@)(?i:supports){{break}}
      captures:
        0: keyword.control.directive.css
        1: punctuation.definition.keyword.css
      push: at-supports-content

  at-supports-content:
    - meta_scope: meta.at-rule.supports.css
    - include: at-supports-groups
    - include: at-supports-operators
    - include: at-block
    - include: at-rule-end

  at-supports-operators:
    - match: \b(?i:and|or|not){{break}}
      scope: keyword.operator.logical.css

  at-supports-groups:
    - match: \(
      scope: punctuation.section.group.begin.css
      push: at-supports-group-content

  at-supports-group-content:
    - meta_scope: meta.group.css
    - include: group-end
    - include: at-supports-groups
    - include: at-supports-operators
    - include: rule-list-body

  # @<ident>
  # Fallback context for incomplete or unknown at-rules.
  # https://www.w3.org/TR/css-syntax-3/#at-rule
  # https://www.w3.org/TR/CSS22/syndata.html#parsing-errors
  at-other:
    - match: (@){{ident}}
      push: at-other-content

  at-other-content:
    - meta_scope: meta.at-rule.other.css
    - match: \{
      scope: punctuation.section.block.begin.css
      push: at-other-block-content
    - include: at-rule-end

  at-other-block-content:
    - meta_scope: meta.block.css
    - include: block-end2

  at-block:
    - match: \{
      scope: punctuation.section.block.begin.css
      push: at-block-content

  at-block-content:
    - meta_scope: meta.block.css
    - include: block-end2
    - include: main

  at-rule-end:
    - match: (?=[;{}])
      pop: 1
    - include: comments

###[ MEDIA QUERIES ]###########################################################

  # https://drafts.csswg.org/mediaqueries-5/#media
  media-query-content:
    - include: comma-delimiters
    - include: media-query-conditions
    - include: media-query-types

  media-query-conditions:
    - match: \(
      scope: punctuation.section.group.begin.css
      push: media-query-group-content
    - match: '[<>]=?|='
      scope: keyword.operator.comparison.css
    - match: \b(?i:and|or|not|only){{break}}
      scope: keyword.operator.logic.media.css

  media-query-group-content:
    - meta_scope: meta.group.css
    - include: group-end
    - include: media-query-conditions
    - include: var-functions
    - include: calc-functions
    - include: ratio-constants
    - include: numeric-constants
    - match: |-
        (?xi:
          ({{vendor_prefix}})?
          (
            (?: min- | max- )?
            (?:
              color (?: -gamut | -index )?
            | monochrome | resolution | update
            | (?: device- )? (?: height | width | aspect-ratio | pixel-ratio )
            )
          | (?:any-)?(?: pointer | hover )
          | display-mode | grid | orientation | scan | scripting
          | overflow-(?: block | inline )
          )
        )\s*(:)?
      captures:
        1: support.type.vendor-prefix.css
        2: support.type.property-name.media.css
        3: punctuation.separator.key-value.css
    - match: |-
        \b(?xi:
          # global css constants
            all | inherit | initial | none | unset
          # color-gamut / color-index:
          | srgb | p3 | rec2020
          # display-mode:
          | browser | fullscreen | standalone | minimal-ui
          # hover:
          | hover
          # orientation:
          | landscape | portrait
          # overflow:
          | optional-paged | paged | scroll
          # pointer:
          | coarse | fine
          # scan:
          | interlace | progressive
          # scripting:
          | enabled | initial-only
          # update:
          | fast | normal | slow
        ){{break}}
      scope: support.constant.property-value.css

  media-query-types:
    # Media Types:
    # https://www.w3.org/TR/CSS21/media.html
    # https://drafts.csswg.org/mediaqueries-5/#media-types
    - match: |-
        \b(?xi:
          # global css constants
            all | inherit | initial | none | unset
          # specs
          | print | screen | speech
          # deprecated
          | aural | braille | embossed | handheld | projection | tty | tv
        ){{break}}
      scope: support.constant.media.css

###[ SELECTORS ]###############################################################

  selectors:
    - match: (?=[:.*#[:alpha:]\[])
      push: selector-content

  selector-content:
    - meta_scope: meta.selector.css
    - include: selector-end
    - include: comma-delimiters
    # Html Tags
    - match: '{{html_tags}}'
      scope: entity.name.tag.html.css
    - match: '{{svg_tags}}'
      scope: entity.name.tag.svg.css
    # Custom Elements
    # http://w3c.github.io/webcomponents/spec/custom/#custom-elements-core-concepts
    - match: '{{custom_element_tags}}'
      scope: entity.name.tag.custom.css
    - match: \*
      scope: variable.language.wildcard.asterisk.css
    # Class and Id Selectors
    # https://drafts.csswg.org/selectors-4/#class-html
    - match: \.
      scope: punctuation.definition.entity.css
      push:
        - meta_scope: entity.other.attribute-name.class.css
        - match: '{{ident}}'
          pop: 1
        - include: immediately-pop
    # https://drafts.csswg.org/selectors-4/#id-selectors
    - match: \#
      scope: punctuation.definition.entity.css
      push:
        - meta_scope: entity.other.attribute-name.id.css
        - match: '{{name}}'
          pop: 1
        - include: immediately-pop
    # Attribute Selectors
    # https://drafts.csswg.org/selectors-4/#attribute-selectors
    - match: \[
      scope: punctuation.section.brackets.begin.css
      push:
        - attribute-selector-meta
        - attribute-selector-key
    # Pseudo Classes and Elements
    # https://drafts.csswg.org/selectors-4/#pseudo-classes
    # https://drafts.csswg.org/selectors-4/#pseudo-elements
    - match: '::'
      scope: punctuation.accessor.double-colon.css
      push:
        - include: pseudo-element-css2
        - include: pseudo-element-css3
        - include: immediately-pop
    - match: ':'
      scope: punctuation.accessor.colon.css
      push:
        - include: pseudo-element-css2
        - include: pseudo-class
        - include: immediately-pop
    # Combinators
    # https://drafts.csswg.org/selectors-4/#combinators
    # https://drafts.csswg.org/css-scoping/#deep-combinator
    - match: '{{combinators}}(?![>~+|])'
      scope: keyword.operator.combinator.css
    - match: '{{combinators}}{2,}|\|{3,}'
      scope: invalid.illegal.combinator.css

  selector-end:
    - match: (?=\s*[;@){}])
      pop: 1
    - include: comments

  attribute-selector-meta:
    - meta_scope: meta.attribute-selector.css meta.brackets.css
    - include: immediately-pop

  attribute-selector-key:
    - include: namespace-prefixes
    - match: '{{ident}}'
      scope: entity.other.attribute-name.css
      set: attribute-selector-operator
    - match: \*
      scope: variable.language.wildcard.asterisk.css
      set: attribute-selector-operator
    - include: attribute-selector-operator

  attribute-selector-operator:
    - match: '[~*|^$]?='
      scope: keyword.operator.logical.css
      set:
        - attribute-selector-flag
        - attribute-selector-value
    - include: attribute-selector-flag

  attribute-selector-value:
    - include: comments
    - include: quoted-string
    - match: '[^\s\]\[''"]+'
      scope: meta.string.css string.unquoted.css
      pop: 1
    - include: else-pop

  attribute-selector-flag:
    - match: \b[iI]{{break}}
      scope: keyword.other.css
      set: attribute-selector-end
    - include: attribute-selector-end

  attribute-selector-end:
    - match: \]
      scope: punctuation.section.brackets.end.css
      pop: 1
    - include: selector-end
    - match: \S
      scope: invalid.illegal.css

  # Pseudo Classes
  # https://drafts.csswg.org/selectors-4/#pseudo-classes
  pseudo-class:
    # Functional Pseudo Classes
    # https://drafts.csswg.org/selectors-4/#functional-pseudo-class

    # Functional Pseudo Classes with a single unquoted string
    - match: (?i:dir|lang){{break}}
      scope: meta.function-call.identifier.css entity.other.pseudo-class.css
      set:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: unquoted-strings
        - include: immediately-pop

    # Functional Pseudo Classes with selector list
    - match: (?i:matches|not|has){{break}}
      scope: meta.function-call.identifier.css entity.other.pseudo-class.css
      set:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: selectors
        - include: immediately-pop

    # Special :drop() pseudo-class
    - match: (?i:drop){{break}}
      scope: meta.function-call.identifier.css entity.other.pseudo-class.css
      set:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - match: \b(active|valid|invalid){{break}}
              scope: keyword.other.pseudo-class.css
            - include: var-functions
        - include: immediately-pop

    # Functional Pseudo Classes with `An+B` param
    # An+B Notation: https://drafts.csswg.org/css-syntax/#anb
    # nth-last-child(), nth-child(), nth-last-of-type(), nth-of-type()
    - match: (?i:nth-last-child|nth-child|nth-last-of-type|nth-of-type){{break}}
      scope: meta.function-call.identifier.css entity.other.pseudo-class.css
      set:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - match: \b(even|odd){{break}}
              scope: keyword.other.pseudo-class.css
            - match: (([-+]?)(\d*)(n))\s*(([-+])(\s*\d+))?
              captures:
                1: meta.number.integer.decimal.css
                2: keyword.operator.arithmetic.css
                3: constant.numeric.value.css
                4: constant.numeric.suffix.css
                5: meta.number.integer.decimal.css
                6: keyword.operator.arithmetic.css
                7: constant.numeric.value.css
            - match: '[-+]\s+\d+n?|[-+]?\d+\s+n'
              scope: invalid.illegal.numeric.css
            - include: var-functions
            - include: scalar-integer-constants
        - include: immediately-pop

    # Regular Pseudo Classes
    - match: '{{ident}}'
      scope: entity.other.pseudo-class.css
      pop: 1

  # Pseudo Elements
  # https://drafts.csswg.org/selectors-4/#pseudo-elements
  pseudo-element-css2:
    # CSS1 & CSS2 require : or ::
    - match: (?i:before|after|first-line|first-letter){{break}}
      scope: entity.other.pseudo-element.css
      pop: 1

  pseudo-element-css3:
    # CSS3 requires ::
    - match: ({{vendor_prefix}})?{{ident}}
      captures:
        0: entity.other.pseudo-element.css
        1: support.type.vendor-prefix.css
      pop: 1

  # Qualified Names
  # https://drafts.csswg.org/css-namespaces-3/#css-qnames
  namespace-prefixes:
    - match: (?:({{ident}})|(\*))?(\|)(?!=)
      captures:
        1: entity.other.namespace-prefix.css
        2: variable.language.wildcard.asterisk.css
        3: punctuation.separator.namespace.css

  vendor-prefixes:
    - match: '{{vendor_prefix}}'
      scope: support.type.vendor-prefix.css

###[ PROPERTY LISTS ]##########################################################

  property-lists:
    - match: \{
      scope: punctuation.section.block.begin.css
      push: property-list-content

  property-list-content:
    - meta_scope: meta.property-list.css meta.block.css
    - match: \}
      scope: punctuation.section.block.end.css
      pop: 1
    - include: rule-list-body

  rule-list:
    - match: \{
      scope: punctuation.section.block.begin.css
      push: rule-list-content

  rule-list-content:
    - meta_scope: meta.property-list.css meta.block.css
    - include: block-end2
    - include: rule-list-body

  rule-list-body:
    # Note: This context is used by HTML.sublime-syntax
    - include: comments
    - include: property-identifiers
    - include: property-values
    - include: rule-terminators
    - include: illegal-blocks

###[ PROPERTY IDENTIFIERS ]####################################################

  property-identifiers:
    - match: (?=[-[:alpha:]])
      push: property-identifier-content

  property-identifier-content:
    - meta_scope: meta.property-name.css
    - include: vendor-prefixes
    # specific properties with special treatment
    - include: counter-property
    - include: counter-style-fallback-property
    - include: counter-style-system-property
    - include: counter-style-speak-as-property
    - include: font-property
    # common properties
    - include: builtin-property
    - include: custom-property
    - include: deprecated-property
    # bailout
    - include: immediately-pop

  builtin-property:
    - match: '{{property_names}}'
      scope: support.type.property-name.css
      pop: 1

  # Custom Properties
  # https://drafts.csswg.org/css-variables/#typedef-custom-property
  custom-property:
    # custom property definition
    - match: (--){{name}}
      scope: entity.other.custom-property.css
      captures:
        1: punctuation.definition.custom-property.css
      pop: 1

  deprecated-property:
    - match: \b(var-)({{ident}})
      scope: invalid.deprecated.custom-property.css
      captures:
        1: entity.other.custom-property.prefix.css
        2: entity.other.custom-property.name.css
      pop: 1

###[ PROPERTY VALUES ]#########################################################

  property-values:
    - match: ':'
      scope: punctuation.separator.key-value.css
      push: property-value-content

  property-value-content:
    - meta_content_scope: meta.property-value.css
    - include: terminator-pop
    - include: comments
    - include: comma-delimiters
    - include: builtin-values
    - match: \!\s*(?i:important){{break}}
      scope: keyword.other.important.css
    - match: /
      scope: keyword.operator.arithmetic.css

  builtin-values:
    - include: builtin-functions
    - include: color-values
    - include: line-names
    - include: unicode-ranges
    - include: numeric-constants
    - include: common-constants
    - include: quoted-strings
    - include: vendor-prefixes

  # When including `color-values` and `color-adjuster-functions`, make sure it is
  # included after the color adjustors to prevent `color-values` from consuming
  # conflicting function names & color constants such as `red`, `green`, or `blue`.
  color-values:
    - include: color-functions
    - include: color-constants

  counter-symbol-values:
    - include: var-functions
    - include: image-values
    - include: counter-system-constants
    - include: scalar-integer-constants
    - include: quoted-strings

  # https://drafts.csswg.org/css-images-3/#typedef-image
  image-values:
    - include: cross-fade-functions
    - include: gradient-functions
    - include: image-functions
    - include: image-set-functions
    - include: url-functions

###[ COUNTER PROPERTY ]########################################################

  counter-property:
    # https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Lists_and_Counters/Using_CSS_counters
    - match: \b(?i:counter-(increment|reset|set)){{break}}
      scope: support.type.property-name.css
      set: counter-property-value

  counter-property-value:
    - match: ':'
      scope: punctuation.separator.key-value.css
      set:
        - property-value-content
        - counter-identifier
    - include: else-pop

  counter-identifier:
    - match: '{{ident}}'
      scope: entity.other.counter-name.css
      pop: 1
    - include: comments
    - include: else-pop

###[ COUNTER STYLE FALLBACK PROPERTY ]#########################################

  # Counter Style Fallback
  # https://drafts.csswg.org/css-counter-styles-3/#counter-style-fallback
  counter-style-fallback-property:
    - match: \b(?i:fallback){{break}}
      scope: support.type.property-name.css
      set: counter-style-fallback-property-value

  counter-style-fallback-property-value:
    - match: ':'
      scope: punctuation.separator.key-value.css
      set: counter-style-fallback-property-value-content
    - include: else-pop

  counter-style-fallback-property-value-content:
    - meta_content_scope: meta.property-value.css
    - include: terminator-pop
    - include: comments
    - include: var-functions
    - include: counter-style-identifiers

  counter-style-identifiers:
    - match: '{{counter_style_names}}'
      scope: support.constant.counter-style-name.css
    - match: '{{ident}}'
      scope: entity.other.counter-style-name.css

###[ COUNTER STYLE SYSTEM PROPERTY ]###########################################

  # Counter Style System
  # https://drafts.csswg.org/css-counter-styles-3/#counter-style-system
  counter-style-system-property:
    - match: \b(?i:system){{break}}
      scope: support.type.property-name.css
      set: counter-style-system-property-value

  counter-style-system-property-value:
    - match: ':'
      scope: punctuation.separator.key-value.css
      set: counter-style-system-property-value-content
    - include: else-pop

  counter-style-system-property-value-content:
    - meta_content_scope: meta.property-value.css
    - include: terminator-pop
    - include: comments
    - include: counter-symbol-values
    - match: \b(?i:extends){{break}}
      scope: keyword.declaration.extends.css
      push: counter-style-identifier

  counter-style-identifier:
    - match: '{{counter_style_names}}'
      scope: support.constant.counter-style-name.css
      pop: 1
    - match: '{{ident}}'
      scope: entity.other.counter-style-name.css
      pop: 1
    - include: comments
    - include: else-pop

###[ COUNTER STYLE SPEAK AS PROPERTY ]#########################################

  # Counter Style Speak As
  # https://drafts.csswg.org/css-counter-styles-3/#counter-style-speak-as
  counter-style-speak-as-property:
    - match: \b(?i:speak-as){{break}}
      scope: support.type.property-name.css
      set: counter-style-speak-as-property-value

  counter-style-speak-as-property-value:
    - match: ':'
      scope: punctuation.separator.key-value.css
      set: counter-style-speak-as-property-value-content
    - include: else-pop

  counter-style-speak-as-property-value-content:
    - meta_content_scope: meta.property-value.css
    - include: terminator-pop
    - include: comments
    - include: var-functions
    - include: quoted-strings
    - include: counter-speak-as-constants
    - include: counter-style-identifiers

###[ FONT PROPERTY ]###########################################################

  font-property:
    - match: \b(?i:font(-family)?){{break}}
      scope: support.type.property-name.css
      set: font-property-value

  font-property-value:
    - match: ':'
      scope: punctuation.separator.key-value.css
      set: font-property-value-content
    - include: else-pop

  font-property-value-content:
    - meta_content_scope: meta.property-value.css
    - include: property-value-content
    - include: unquoted-name-strings

###[ BUILTIN FUNCTIONS ]#######################################################

  builtin-functions:
    - include: attr-functions
    - include: calc-functions
    - include: cross-fade-functions
    - include: counter-style-functions
    - include: filter-functions
    - include: gradient-functions
    - include: image-functions
    - include: image-set-functions
    - include: minmax-functions
    - include: url-functions
    - include: var-functions
    - include: color-adjuster-functions

    # filter()
    # https://drafts.fxtf.org/filters/#funcdef-filter
    - match: \b(?i:filter)(?=\()
      scope: meta.function-call.identifier.css support.function.filter.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: filter-functions
            - include: image-values
            - include: quoted-strings

    # format()
    # https://drafts.csswg.org/css-fonts-3/#descdef-src
    # format() is also mentioned in `issue 2` at https://drafts.csswg.org/css-images-3/#issues-index
    # but does not seem to be implemented in any manner
    - match: \b(?i:format)(?=\()
      scope: meta.function-call.identifier.css support.function.font-face.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: quoted-strings

    # local()
    # https://drafts.csswg.org/css-fonts-3/#descdef-src
    - match: \b(?i:local)(?=\()
      scope: meta.function-call.identifier.css support.function.font-face.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: quoted-strings
            - include: unquoted-strings

    # Transform Functions
    # https://www.w3.org/TR/css-transforms-1/#transform-functions

    # transform functions with comma separated <number> types
    # matrix(), scale(), matrix3d(), scale3d()
    - match: \b(?i:matrix3d|scale3d|matrix|scale)(?=\()
      scope: meta.function-call.identifier.css support.function.transform.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: scalar-constants

    # transform functions with comma separated <number> or <length> types
    # translate(), translate3d()
    - match: \b(?i:translate(3d)?)(?=\()
      scope: meta.function-call.identifier.css support.function.transform.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: percentage-constants
            - include: length-constants
            - include: scalar-constants

    # transform functions with a single <number> or <length> type
    # translateX(), translateY()
    - match: \b(?i:translate[XY])(?=\()
      scope: meta.function-call.identifier.css support.function.transform.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: percentage-constants
            - include: length-constants
            - include: scalar-constants

    # transform functions with a single <angle> type
    # rotate(), skewX(), skewY(), rotateX(), rotateY(), rotateZ()
    - match: \b(?i:rotate[XYZ]?|skew[XY])(?=\()
      scope: meta.function-call.identifier.css support.function.transform.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: angle-constants

    # transform functions with comma separated <angle> types
    # skew()
    - match: \b(?i:skew)(?=\()
      scope: meta.function-call.identifier.css support.function.transform.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: angle-constants

    # transform functions with a single <length> type
    # translateZ(), perspective()
    - match: \b(?i:translateZ|perspective)(?=\()
      scope: meta.function-call.identifier.css support.function.transform.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: length-constants

    # transform functions with a comma separated <number> or <angle> types
    # rotate3d()
    - match: \b(?i:rotate3d)(?=\()
      scope: meta.function-call.identifier.css support.function.transform.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: angle-constants
            - include: scalar-constants

    # transform functions with a single <number> type
    # scaleX(), scaleY(), scaleZ()
    - match: \b(?i:scale[XYZ])(?=\()
      scope: meta.function-call.identifier.css support.function.transform.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: scalar-constants

    # Timing Functions
    # https://www.w3.org/TR/web-animations-1/#timing-functions

    # cubic-bezier()
    # https://www.w3.org/TR/web-animations-1/#cubic-bzier-timing-function
    - match: \b(?i:cubic-bezier)(?=\()
      scope: meta.function-call.identifier.css support.function.timing.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: scalar-constants

    # steps()
    # https://www.w3.org/TR/web-animations-1/#step-timing-function
    - match: \b(?i:steps)(?=\()
      scope: meta.function-call.identifier.css support.function.timing.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - match: \b(?i:end|middle|start){{break}}
              scope: support.keyword.timing-direction.css
            - include: var-functions
            - include: scalar-integer-constants

    # Shape Functions
    # https://www.w3.org/TR/css-shapes-1/#typedef-basic-shape

    # rect() - Deprecated
    # https://drafts.fxtf.org/css-masking-1/#funcdef-clip-rect
    - match: \b(?i:rect)(?=\()
      scope: meta.function-call.identifier.css support.function.shape.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - match: \b(?i:auto){{break}}
              scope: support.constant.property-value.css
            - include: var-functions
            - include: length-constants

    # inset()
    # https://www.w3.org/TR/css-shapes-1/#funcdef-inset
    - match: \b(?i:inset)(?=\()
      scope: meta.function-call.identifier.css support.function.shape.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - match: \b(?i:round){{break}}
              scope: keyword.other.css
            - include: var-functions
            - include: length-constants
            - include: percentage-constants

    # circle()
    # https://www.w3.org/TR/css-shapes-1/#funcdef-circle
    # ellipse()
    # https://www.w3.org/TR/css-shapes-1/#funcdef-ellipse
    - match: \b(?i:circle|ellipse)(?=\()
      scope: meta.function-call.identifier.css support.function.shape.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - match: \b(?i:at){{break}}
              scope: keyword.other.css
            - match: \b(?i:top|right|bottom|left|center|closest-side|farthest-side){{break}}
              scope: support.constant.property-value.css
            - include: var-functions
            - include: length-constants
            - include: percentage-constants

    # polygon()
    # https://www.w3.org/TR/css-shapes-1/#funcdef-polygon
    - match: \b(?i:polygon)(?=\()
      scope: meta.function-call.identifier.css support.function.shape.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - match: \b(?i:nonzero|evenodd){{break}}
              scope: support.constant.property-value.css
            - include: calc-functions
            - include: var-functions
            - include: length-constants
            - include: percentage-constants

    # toggle()
    # https://www.w3.org/TR/css3-values/#toggle-notation
    - match: \b(?i:toggle)(?=\()
      scope: meta.function-call.identifier.css support.function.toggle.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: vendor-prefixes
            - include: color-values
            - include: common-constants
            - include: numeric-constants
            - include: quoted-strings

    # repeat()
    # https://drafts.csswg.org/css-grid/#funcdef-repeat
    - match: \b(?i:repeat)(?=\()
      scope: meta.function-call.identifier.css support.function.grid.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - match: \b(?i:auto-fill|auto-fit){{break}}
              scope: support.keyword.repetitions.css
            - match: \b(?i:max-content|min-content|auto){{break}}
              scope: support.constant.property-value.css
            - include: minmax-functions
            - include: var-functions
            - include: length-constants
            - include: percentage-constants
            - include: scalar-integer-constants
            - include: line-names

  counter-style-functions:
    # counter()
    # https://drafts.csswg.org/css-lists-3/#funcdef-counter
    # counters()
    # https://drafts.csswg.org/css-lists-3/#funcdef-counters
    - match: \b(?i:counters?)(?=\()
      scope: meta.function-call.identifier.css support.function.counter.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - - meta_scope: meta.function-call.arguments.css meta.group.css
              - include: group-end
              - include: comma-delimiters
              - include: var-functions
              - include: counter-style-identifiers
              - include: quoted-strings
            - counter-identifier

    # symbols()
    # https://drafts.csswg.org/css-counter-styles-3/#symbols-function
    - match: \b(?i:symbols)(?=\()
      scope: meta.function-call.identifier.css support.function.counter.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: counter-symbol-values

  # var()
  # https://drafts.csswg.org/css-variables/#funcdef-var
  var-functions:
    - match: \b(?i:var)(?=\()
      scope: meta.function-call.identifier.css support.function.var.css
      push: var-function-arguments

  var-function:
    - match: \b(?i:var)(?=\()
      scope: meta.function-call.identifier.css support.function.var.css
      set: var-function-arguments

  var-function-arguments:
    - match: \(
      scope: punctuation.section.group.begin.css
      set:
        - meta_scope: meta.function-call.arguments.css meta.group.css
        - include: group-end
        - include: var-functions
        - include: custom-properties
        - match: (?=,)
          push:
            - include: property-value-content

  # Filter Functions
  # https://drafts.fxtf.org/filters/#typedef-filter-function
  filter-functions:
    # blur()
    # https://drafts.fxtf.org/filters/#funcdef-filter-blur
    - match: \b(?i:blur)(?=\()
      scope: meta.function-call.identifier.css support.function.filter.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: length-constants

    # brightness(), contrast(), grayscale(), invert(), opacity(), saturate(), sepia()
    # https://drafts.fxtf.org/filters/#funcdef-filter-brightness
    - match: \b(?i:brightness|contrast|grayscale|invert|opacity|saturate|sepia)(?=\()
      scope: meta.function-call.identifier.css support.function.filter.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: percentage-constants
            - include: scalar-constants

    # drop-shadow()
    # https://drafts.fxtf.org/filters/#funcdef-filter-drop-shadow
    - match: \b(?i:drop-shadow)(?=\()
      scope: meta.function-call.identifier.css support.function.filter.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: color-values
            - include: length-constants

    # hue-rotate()
    # https://drafts.fxtf.org/filters/#funcdef-filter-hue-rotate
    - match: \b(?i:hue-rotate)(?=\()
      scope: meta.function-call.identifier.css support.function.filter.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: angle-constants

  # calc()
  # https://www.w3.org/TR/css3-values/#funcdef-calc
  calc-functions:
    - match: \b(?i:calc)(?=\()
      scope: meta.function-call.identifier.css support.function.calc.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: calc-function-arguments-content

  calc-function-arguments-content:
    - meta_scope: meta.group.css
    - match: \)
      scope: punctuation.section.group.end.css
      set: maybe-illegal-operator
    - include: terminator-pop
    - include: comments
    - include: attr-functions
    - include: calc-functions
    - include: var-functions
    - include: numeric-constants
    - match: '[-+*/]'
      scope: keyword.operator.arithmetic.css
    - match: \(
      scope: punctuation.section.group.begin.css
      push: calc-function-arguments-content

  # attr()
  # https://www.w3.org/TR/css3-values/#funcdef-attr
  attr-functions:
    - match: \b(?i:attr)(?=\()
      scope: meta.function-call.identifier.css support.function.attr.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - attr-function-arguments-value
            - attr-function-arguments-identifier

  attr-function-arguments-identifier:
    - include: namespace-prefixes
    - include: quoted-string
    - include: var-function
    - match: '{{ident}}'
      scope: entity.other.attribute-name.css
      pop: 1
    - include: comments
    - include: else-pop

  attr-function-arguments-value:
    - meta_scope: meta.function-call.arguments.css meta.group.css
    - include: group-end
    - include: comma-delimiters
    - match: |-
        \b(?x:
            {{font_relative_lengths}}
          | {{viewport_percentage_lengths}}
          | {{absolute_lengths}}
          | {{angle_units}}
          | {{duration_units}}
          | {{frequency_units}}
          | {{resolution_units}}
        ){{break}}
      scope: keyword.other.unit.css
    - include: var-functions
    - include: color-values
    - include: common-constants
    - include: numeric-constants

  # url()
  # https://drafts.csswg.org/css-images-3/#url-notation
  url-functions:
    - match: \b(?i:url)(?=\()
      scope: meta.function-call.identifier.css support.function.url.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: quoted-strings
            - include: unquoted-strings

  # url-prefix()
  # https://www.w3.org/TR/2012/WD-css3-conditional-20120911/#url-prefix
  url-prefix-functions:
    - match: \b(?i:url-prefix)(?=\()
      scope: meta.function-call.identifier.css support.function.url-prefix.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: quoted-strings
            - include: unquoted-strings

  # domain()
  # https://www.w3.org/TR/2012/WD-css3-conditional-20120911/#url-domain
  domain-functions:
    - match: \b(?i:domain)(?=\()
      scope: meta.function-call.identifier.css support.function.domain.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: quoted-strings
            - include: unquoted-strings

  # regexp()
  # https://www.w3.org/TR/2012/WD-css3-conditional-20120911/#url-regexp
  regexp-functions:
    - match: \b(?i:regexp)(?=\()
      scope: meta.function-call.identifier.css support.function.regexp.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: quoted-strings

  # image()
  # https://drafts.csswg.org/css-images-3/#funcdef-image
  image-functions:
    - match: \b(?i:image)(?=\()
      scope: meta.function-call.identifier.css support.function.image.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: color-values
            - include: image-values
            - include: quoted-strings
            - include: unquoted-strings

  # image-set()
  # https://drafts.csswg.org/css-images-3/#funcdef-image-set
  image-set-functions:
    - match: \b(?i:image-set)(?=\()
      scope: meta.function-call.identifier.css support.function.image.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: color-values
            - include: image-values
            - include: resolution-constants
            - match: ([0-9]+)(x)
              scope: meta.number.integer.decimal.css
              captures:
                1: constant.numeric.value.css
                2: constant.numeric.suffix.css
            - include: quoted-strings
            - include: unquoted-strings

  # Gradient Functions
  # https://drafts.csswg.org/css-images-3/#gradients
  gradient-functions:
    # linear-gradient()
    # https://drafts.csswg.org/css-images-3/#linear-gradients
    # repeating-linear-gradient()
    # https://drafts.csswg.org/css-images-3/#funcdef-repeating-linear-gradient
    - match: \b((?:repeating-)?linear-gradient)(?=\()
      scope: meta.function-call.identifier.css support.function.gradient.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - match: \b(?i:to){{break}}
              scope: keyword.other.css
            - match: \b(?i:top|right|bottom|left){{break}}
              scope: support.constant.property-value.css
            - include: var-functions
            - include: color-values
            - include: angle-constants
            - include: length-constants
            - include: percentage-constants

    # radial-gradient()
    # https://drafts.csswg.org/css-images-3/#radial-gradients
    # repeating-radial-gradient()
    # https://drafts.csswg.org/css-images-3/#funcdef-repeating-radial-gradient
    - match: \b((?:repeating-)?radial-gradient)(?=\()
      scope: meta.function-call.identifier.css support.function.gradient.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - match: \b(?i:at|circle|ellipse){{break}}
              scope: keyword.other.css
            - match: \b(?i:left|center|right|top|bottom|(closest|farthest)-(corner|side)){{break}}
              scope: support.constant.property-value.css
            - include: var-functions
            - include: color-values
            - include: length-constants
            - include: percentage-constants

  # cross-fade()
  # https://drafts.csswg.org/css-images-3/#cross-fade-functions
  cross-fade-functions:
    - match: \b(?i:cross-fade)(?=\()
      scope: meta.function-call.identifier.css support.function.image.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: color-values
            - include: image-values
            - include: percentage-constants
            - include: quoted-strings
            - include: unquoted-strings

  # minmax()
  # https://drafts.csswg.org/css-grid/#valdef-grid-template-columns-minmax
  minmax-functions:
    - match: \b(?i:minmax)(?=\()
      scope: meta.function-call.identifier.css support.function.grid.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - match: \b(?i:auto|max-content|min-content){{break}}
              scope: support.constant.property-value.css
            - include: var-functions
            - include: length-constants
            - include: percentage-constants

  # Color Functions
  # https://drafts.csswg.org/css-color
  color-functions:
    # rgb(), rgba()
    # https://drafts.csswg.org/css-color/#rgb-functions
    - match: \b(?i:rgba?)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: percentage-constants
            - include: scalar-constants

    # hsl(), hsla()
    # https://drafts.csswg.org/css-color/#the-hsl-notation
    # hwb() - Not yet implemented by browsers
    # https://drafts.csswg.org/css-color/#funcdef-hwb
    - match: \b(?i:hsla?|hwb)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: angle-constants
            - include: percentage-constants
            - include: scalar-constants

    # gray() - Not yet implemented by browsers
    # https://drafts.csswg.org/css-color/#funcdef-gray
    - match: \b(?i:gray)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: percentage-constants
            - include: scalar-constants

    # device-cmyk() - Not yet implemented by browsers
    # https://drafts.csswg.org/css-color/#funcdef-device-cmyk
    - match: \b(?i:device-cmyk)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: color-adjuster-functions # must be included before `color-values`
            - include: color-values
            - include: percentage-constants
            - include: scalar-constants

    # color-mod() - Not yet implemented by browsers
    # https://drafts.csswg.org/css-color/#funcdef-color-mod
    - match: \b(?i:color)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: comma-delimiters
            - include: var-functions
            - include: color-adjuster-functions # must be included before `color-values`
            - include: color-values
            - include: angle-constants
            - include: scalar-constants

  # Color Adjuster Functions - Not yet implemented by browsers
  # https://drafts.csswg.org/css-color/#typedef-color-adjuster
  color-adjuster-functions:
    # red(), green(), blue(), alpha() - Not yet implemented by browsers
    - match: \b(?i:red|green|blue|alpha|a)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: color-adjuster-operators
            - include: percentage-constants
            - include: scalar-constants

    # hue() - Not yet implemented by browsers
    - match: \b(?i:hue|h)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: color-adjuster-operators
            - include: angle-constants

    # saturation(), lightness(), whiteness(), blackness() - Not yet implemented by browsers
    - match: \b(?i:saturation|lightness|whiteness|blackness|[slwb])(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: color-adjuster-operators
            - include: percentage-constants

    # tint(), shade(), contrast() - Not yet implemented by browsers
    # contrast() interferes with the contrast() filter function;
    # therefore, it is not yet implemented here
    - match: \b(?i:tint|shade)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - include: var-functions
            - include: percentage-constants

    # blend(), blenda() - Not yet implemented by browsers
    - match: \b(?i:blenda|blend)(?=\()
      scope: meta.function-call.identifier.css support.function.color.css
      push:
        - match: \(
          scope: punctuation.section.group.begin.css
          set:
            - meta_scope: meta.function-call.arguments.css meta.group.css
            - include: group-end
            - match: \b(?i:rgb|hsl|hwb){{break}}
              scope: keyword.other.color-space.css
            - include: var-functions
            - include: color-values
            - include: percentage-constants

###[ CONSTANTS ]###############################################################

  color-constants:
    # https://www.w3.org/TR/CSS22/syndata.html#color-units
    - match: '{{standard_colors}}'
      scope: support.constant.color.w3c.standard.css
    # https://www.w3.org/TR/css3-color/#svg-color
    - match: '{{extended_colors}}'
      scope: support.constant.color.w3c.extended.css
    # Special Color Keywords
    # https://www.w3.org/TR/css3-color/#currentcolor
    # https://www.w3.org/TR/css3-color/#transparent-def
    - match: \b(?i:currentColor|transparent){{break}}
      scope: support.constant.color.w3c.special.css
    # Hex Color
    - match: (#)(\h{3}|\h{6}){{break}}
      scope: constant.other.color.rgb-value.css
      captures:
        1: punctuation.definition.constant.css
    # RGBA Hexadecimal Colors
    # https://en.wikipedia.org/wiki/RGBA_color_space#RGBA_hexadecimal_.28word-order.29
    - match: (#)(\h{4}|\h{8}){{break}}
      scope: constant.other.color.rgba-value.css
      captures:
        1: punctuation.definition.constant.css

  common-constants:
    - match: '{{property_values}}'
      scope: support.constant.property-value.css
    - match: '{{font_family_constants}}'
      scope: support.constant.font-name.css

  counter-speak-as-constants:
    - match: '{{counter_speak_as_constants}}'
      scope: support.constant.property-value.css

  counter-system-constants:
    - match: '{{counter_system_constants}}'
      scope: support.constant.symbol-type.css

  # Custom Properties
  # https://drafts.csswg.org/css-variables/#typedef-custom-property
  custom-properties:
    # custom property reference
    - match: (--){{name}}
      scope: variable.other.custom-property.css
      captures:
        1: punctuation.definition.custom-property.css

###[ NUMERIC CONSTANTS ]#######################################################

  # https://www.w3.org/TR/css3-values/#numeric-constantss
  numeric-constants:
    - include: angle-constants
    - include: frequency-constants
    - include: length-constants
    - include: resolution-constants
    - include: percentage-constants
    - include: time-constants
    - include: scalar-constants

  # Make sure `scalar-constants` is included after any other numeric values
  # as `scalar-constants` will consume all numeric values.
  scalar-constants:
    - include: scalar-float-constants
    - include: scalar-integer-constants

  scalar-float-constants:
    - match: '{{float}}'
      scope: meta.number.float.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: punctuation.separator.decimal.css
      push: maybe-illegal-operator

  scalar-integer-constants:
    - match: '{{integer}}'
      scope: meta.number.integer.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
      push: maybe-illegal-operator

  angle-constants:
    - match: '{{float}}({{angle_units}})\b'
      scope: meta.number.float.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: punctuation.separator.decimal.css
        4: constant.numeric.suffix.css
      push: maybe-illegal-operator
    - match: '{{integer}}({{angle_units}})\b'
      scope: meta.number.integer.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: constant.numeric.suffix.css
      push: maybe-illegal-operator
    - match: \b0\b(?!%)
      scope: meta.number.integer.decimal.css constant.numeric.value.css
      push: maybe-illegal-operator

  frequency-constants:
    - match: '{{float}}({{frequency_units}})\b'
      scope: meta.number.float.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: punctuation.separator.decimal.css
        4: constant.numeric.suffix.css
      push: maybe-illegal-operator
    - match: '{{integer}}({{frequency_units}})\b'
      scope: meta.number.integer.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: constant.numeric.suffix.css
      push: maybe-illegal-operator

  length-constants:
    - match: '{{float}}({{font_relative_lengths}}|{{viewport_percentage_lengths}}|{{absolute_lengths}})\b'
      scope: meta.number.float.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: punctuation.separator.decimal.css
        4: constant.numeric.suffix.css
      push: maybe-illegal-operator
    - match: '{{integer}}({{font_relative_lengths}}|{{viewport_percentage_lengths}}|{{absolute_lengths}})\b'
      scope: meta.number.integer.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: constant.numeric.suffix.css
      push: maybe-illegal-operator
    - match: \b0\b(?!%)
      scope: meta.number.integer.decimal.css constant.numeric.value.css
      push: maybe-illegal-operator

  ratio-constants:
    - match: (\d+)(/)(\d+)
      captures:
        1: meta.number.integer.decimal.css constant.numeric.value.css
        2: keyword.operator.arithmetic.css
        3: meta.number.integer.decimal.css constant.numeric.value.css

  resolution-constants:
    - match: '{{float}}({{resolution_units}})\b'
      scope: meta.number.float.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: punctuation.separator.decimal.css
        4: constant.numeric.suffix.css
      push: maybe-illegal-operator
    - match: '{{integer}}({{resolution_units}})\b'
      scope: meta.number.integer.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: constant.numeric.suffix.css
      push: maybe-illegal-operator

  percentage-constants:
    - match: '{{float}}(%)'
      scope: meta.number.float.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: punctuation.separator.decimal.css
        4: constant.numeric.suffix.css
      push: maybe-illegal-operator
    - match: '{{integer}}(%)'
      scope: meta.number.integer.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: constant.numeric.suffix.css
      push: maybe-illegal-operator

  time-constants:
    - match: '{{float}}({{duration_units}})\b'
      scope: meta.number.float.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: punctuation.separator.decimal.css
        4: constant.numeric.suffix.css
      push: maybe-illegal-operator
    - match: '{{integer}}({{duration_units}})\b'
      scope: meta.number.integer.decimal.css
      captures:
        1: keyword.operator.arithmetic.css
        2: constant.numeric.value.css
        3: constant.numeric.suffix.css
      push: maybe-illegal-operator

  unicode-ranges:
    - match: ([Uu]\+)([\h?]{1,6}(?:(-)\h{1,6})?)
      scope: meta.number.unicode-range.css
      captures:
        1: constant.numeric.prefix.css
        2: constant.numeric.value.css
        3: punctuation.separator.range.css

###[ STRING CONSTANTS ]########################################################

  # Named Grid Lines
  # https://drafts.csswg.org/css-grid/#named-lines
  line-names:
    - match: \[
      scope: punctuation.section.brackets.begin.css
      push: line-names-content

  line-names-content:
    - meta_scope: meta.line-names.css meta.brackets.css
    - match: \]
      scope: punctuation.section.brackets.end.css
      pop: 1
    - match: '{{ident}}'
      scope: meta.string.css string.unquoted.line-name.css
    - include: terminator-pop

  quoted-strings:
    - match: \"
      scope: punctuation.definition.string.begin.css
      push: double-quoted-string-content
    - match: \'
      scope: punctuation.definition.string.begin.css
      push: single-quoted-string-content

  quoted-string:
    - match: \"
      scope: punctuation.definition.string.begin.css
      set: double-quoted-string-content
    - match: \'
      scope: punctuation.definition.string.begin.css
      set: single-quoted-string-content

  double-quoted-string-content:
    - meta_include_prototype: false
    - meta_scope: meta.string.css string.quoted.double.css
    - match: \"
      scope: punctuation.definition.string.end.css
      pop: 1
    - include: string-content

  single-quoted-string-content:
    - meta_include_prototype: false
    - meta_scope: meta.string.css string.quoted.single.css
    - match: \'
      scope: punctuation.definition.string.end.css
      pop: 1
    - include: string-content

  string-content:
    - meta_include_prototype: false
    - match: \n
      scope: invalid.illegal.newline.css
      pop: 1
    - match: \\\s*\n
      scope: constant.character.escape.newline.css
    - match: \\(?:\h{1,6}|.)
      scope: constant.character.escape.css

  unquoted-strings:
    - match: '[^\s''"]'
      scope: meta.string.css string.unquoted.css

  unquoted-name-strings:
    - match: '{{ident}}(?:\s+{{ident}}(?!\())*'
      scope: meta.string.css string.unquoted.css

###[ OPERATORS ]###############################################################

  color-adjuster-operators:
    - match: '[-+*](?=\s)'
      scope: keyword.operator.arithmetic.css
    - match: '[-+*/]'
      scope: invalid.illegal.operator.css

  maybe-illegal-operator:
    - match: '[-+](?=\s*\d)'
      scope: invalid.illegal.operator.css
      pop: 1
    - match: \s*([-+])(?=\d)
      captures:
        1: invalid.illegal.operator.css
      pop: 1
    - include: immediately-pop

###[ PUNCTUATION ]#############################################################

  comma-delimiters:
    - match: ','
      scope: punctuation.separator.sequence.css

  block-end2:
    - match: \}
      scope: punctuation.section.block.end.css
      pop: 2

  group-end:
    - match: \)
      scope: punctuation.section.group.end.css
      pop: 1
    - include: terminator-pop
    - include: comments

  rule-terminators:
    - match: ;
      scope: punctuation.terminator.rule.css

  illegal-blocks:
    # https://www.w3.org/TR/CSS22/syndata.html#parsing-errors
    - match: \{
      scope: invalid.illegal.unexpected-token.css
      push:
        - match: \}
          scope: invalid.illegal.unexpected-token.css
          pop: 1
    - match: \}
      scope: invalid.illegal.unexpected-token.css

###[ PROTOTYPES ]##############################################################

  else-pop:
    - match: (?=\S)
      pop: 1

  immediately-pop:
    - match: ''
      pop: 1

  terminator-pop:
    - match: (?=[;@){}])
      pop: 1
