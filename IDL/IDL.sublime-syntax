%YAML 1.2
---
# http://www.sublimetext.com/docs/3/syntax.html
name: IDL
comment: "IDL Syntax: version 0.1"
file_extensions:
  - pro
scope: source.idl
contexts:
  main:
    - include: statements
    - match: '(?i)\b(pro|function)\b'
      scope: meta.function.idl
      captures:
        1: keyword.control.idl
      push:
        - meta_scope: function.definition.idl
        - match: '(?i)\b(end)$\n?'
          captures:
            1: keyword.control.idl
          pop: true
        - match: '(?i)\b(pro|function)\b'
          scope: invalid.illegal.idl
        - match: '(?i)(?<=function|pro)\s+(\b[a-zA-Z_:]+::)?\b([a-zA-Z_][a-zA-Z_0-9]*)\b'
          scope: meta.function.idl
          captures:
            1: entity.name.function.scope.idl
            2: entity.name.function.idl
          push:
            - meta_scope: function.parameter-list.idl
            - match: '(?<!\$)\s*$\n?'
              pop: true
            - match: '\$'
              scope: punctuation.line-continuation.idl
            - match: ','
              scope: punctuation.separator.idl
              push:
                - meta_scope: function.parameter.idl
                - match: '\$'
                  scope: punctuation.line-continuation.idl
                - match: '\b([a-zA-Z_][a-zA-Z_0-9]*)\b(?!\s*=)'
                  pop: true
                  captures:
                    1: variable.parameter.idl
                - match: '\b([a-zA-Z_][a-zA-Z_0-9]*)\b(\s*(=)\s*\b([a-zA-Z_][a-zA-Z_0-9]*)\b)?'
                  pop: true
                  captures:
                    1: variable.parameter.keyword.public.idl
                    3: keyword.operator.assignment.idl
                    4: variable.parameter.keyword.private.idl
        - include: statements
  statements:
    - match: '(;).*$\n?'
      scope: comment.line.idl
      captures:
        1: punctuation.definition.comment.idl
    - include: expressions
  expressions:
    - match: '(?i)((\b[0-9]+(b|l|ul|u|ll|ull))|(\.[0-9]+|(\b[0-9]+(\.[0-9]*)?))((e|d)-?[0-9]+)?)'
      scope: constant.numeric.idl
    - match: "(')"
      captures:
        0: punctuation.definition.string.begin.idl
      push:
        - meta_scope: string.quoted.single.idl
        - match: "(')"
          captures:
            0: punctuation.definition.string.end.idl
          pop: true
    - match: '(")'
      captures:
        0: punctuation.definition.string.begin.idl
      push:
        - meta_scope: string.quoted.double.idl
        - match: '(")'
          captures:
            0: punctuation.definition.string.end.idl
          pop: true
    - match: (?i)\b(begin|break|do|else|for|if|return|then|repeat|while|end|endif|endelse|endfor|endwhile|return|goto)\b
      scope: keyword.control.idl
    - match: '\![a-zA-Z_][a-zA-Z_0-9]*\b'
      scope: constant.language.idl
    - match: '(?<![^.]\.|:)\b(self)\b'
      scope: variable.language.self.idl
    - match: '(?i)(?<![^.]\.|:)\b(abs|acos|adapt_hist_equal|alog|alog10|amoeba|annotate|app_user_dir|app_user_dir_query|arg_present|array_equal|array_indices|arrow|ascii_template|asin|assoc|atan|axis|bar_plot|beseli|beselj|beselk|besely|beta|bilinear|binary_template|bindgen|binomial|bin_date|blas_axpy|blk_con|box_cursor|breakpoint|broyden|bytarr|byte|byteorder|bytscl|caldat|calendar|call_external|call_function|call_method|call_procedure|catch|cd|ceil|chebyshev|check_math|chisqr_cvf|chisqr_pdf|choldc|cholsol|cindgen|cir_3pnt|close|cluster|cluster_tree|clust_wts|colormap_applicable|color_convert|color_quan|comfit|complex|complexarr|complexround|compute_mesh_normals|cond|congrid|conj|constrained_min|contour|convert_coord|convol|coord2to3|copy_lun|correlate|cos|cosh|cpu|cramer|create_cursor|create_struct|create_view|crossp|crvlength|cti_test|ct_luminance|cursor|curvefit|cvttobm|cv_coord|c_correlate|dblarr|dcindgen|dcomplex|dcomplexarr|define_key|define_msgblk|define_msgblk_from_file|defroi|defsysv|delvar|dendrogram|dendro_plot|deriv|derivsig|determ|device|dfpmin|diag_matrix|dialog_message|dialog_pickfile|dialog_printersetup|dialog_printjob|dialog_read_image|dialog_write_image|digital_filter|dilate|dindgen|dissolve|dist|distance_measure|dlm_load|dlm_register|doc_library|double|draw_roi|efont|eigenql|eigenvec|elmhes|empty|enable_sysrtn|eof|erase|erf|erfc|erfcx|erode|errplot|execute|exit|exp|expand|expand_path|expint|extrac|extract_slice|factorial|fft|filepath|file_basename|file_chmod|file_copy|file_delete|file_dirname|file_expand_path|file_info|file_lines|file_link|file_mkdir|file_move|file_readlink|file_same|file_search|file_test|file_which|findgen|finite|fix|flick|float|floor|flow3|fltarr|flush|format_axis_values|forward_function|free_lun|fstat|fulstr|funct|fv_test|fx_root|fz_roots|f_cvf|f_pdf|gamma|gamma_ct|gauss2dfit|gaussfit|gaussint|gauss_cvf|gauss_pdf|getenv|get_drive_list|get_kbrd|get_lun|get_screen_size|grid3|griddata|grid_input|grid_tps|gs_iter|h5_browser|hanning|hdf_browser|hdf_read|heap_free|heap_gc|help|hilbert|histogram|hist_2d|hist_equal|hls|hough|hqr|hsv|h_eq_ct|h_eq_int|ibeta|icontour|identity|idlitsys_createtool|idl_validname|igamma|iimage|image_cont|image_statistics|imaginary|imap|indgen|intarr|interpol|interpolate|interval_volume|int_2d|int_3d|int_tabulated|invert|ioctl|iplot|ishft|isocontour|isosurface|isurface|itcurrent|itdelete|itgetcurrent|itregister|itreset|itresolve|ivolume|journal|julday|keyword_set|krig2d|kurtosis|kw_test|l64indgen|label_date|label_region|ladfit|laguerre|la_choldc|la_cholmprove|la_cholsol|la_determ|la_eigenproblem|la_eigenql|la_eigenvec|la_elmhes|la_gm_linear_model|la_hqr|la_invert|la_least_squares|la_least_square_equality|la_linear_equation|la_ludc|la_lumprove|la_lusol|la_svd|la_tridc|la_trimprove|la_triql|la_trired|la_trisol|leefilt|legendre|linbcg|lindgen|linfit|linkimage|ll_arc_distance|lmfit|lmgr|lngamma|lnp_test|loadct|locale_get|logical_and|logical_or|logical_true|lon64arr|lonarr|long|long64|lsode|ludc|lumprove|lusol|lu_complex|machar|make_array|make_dll|map_2points|map_continents|map_grid|map_image|map_patch|map_proj_forward|map_proj_image|map_proj_info|map_proj_init|map_proj_inverse|map_set|matrix_multiply|matrix_power|max|md_test|mean|meanabsdev|median|memory|message|min|min_curve_surf|mk_html_help|modifyct|moment|morph_close|morph_distance|morph_gradient|morph_hitormiss|morph_open|morph_thin|morph_tophat|mpeg_close|mpeg_open|mpeg_put|mpeg_save|multi|m_correlate|newton|norm|n_elements|n_params|n_tags|objarr|obj_class|obj_destroy|obj_isa|obj_new|obj_valid|online_help|online_help_pdf_index|on_error|on_ioerror|openr|openu|openw|oplot|oploterr|particle_trace|path_cache|path_sep|pcomp|plot|ploterr|plots|plot_3dbox|plot_field|pnt_line|point_lun|polar_contour|polar_surface|poly|polyfill|polyfillv|polyshade|polywarp|poly_2d|poly_area|poly_fit|popd|powell|primes|print|printd|printf|proceduresandfunctions|product|profile|profiler|profiles|project_vol|psafm|pseudo|ps_show_fonts|ptrarr|ptr_free|ptr_new|ptr_valid|pushd|p_correlate|qgrid3|qhull|qromb|qromo|qsimp|radon|randomn|randomu|ranks|rdpix|read|readf|reads|readu|read_ascii|read_binary|read_bmp|read_dicom|read_gif|read_image|read_interfile|read_jpeg|read_jpeg2000|read_mrsid|read_pict|read_png|read_ppm|read_spr|read_srf|read_sylk|read_tiff|read_wav|read_wave|read_x11_bitmap|read_xwd|real_part|rebin|recall_commands|recon3|reduce_colors|reform|region_grow|register_cursor|regress|replicate|replicate_inplace|resolve_all|resolve_routine|restore|reverse|rk4|roberts|rot|rotate|round|routine_info|rs_test|r_correlate|r_test|save|savgol|scale3|scale3d|scope_level|scope_varfetch|scope_varname|search2d|search3d|setenv|setup_keys|set_plot|set_shading|sfit|shade_surf|shade_surf_irr|shade_volume|shift|shmdebug|shmmap|shmunmap|shmvar|show3|showfont|simplex|sin|sindgen|sinh|size|skewness|skip_lun|slicer3|slide_image|smooth|sobel|socket|sort|spawn|spher_harm|sph_4pnt|sph_scat|spline|spline_p|spl_init|spl_interp|sprsab|sprsax|sprsin|sprstp|sqrt|standardize|stddev|stop|strarr|strcmp|strcompress|streamline|stregex|stretch|string|strjoin|strlen|strlowcase|strmatch|strmessage|strmid|strpos|strput|strsplit|strtrim|struct_assign|struct_hide|strupcase|surface|surfr|svdc|svdfit|svsol|swap_endian|swap_endian_inplace|systime|s_test|t3d|tag_names|tan|tanh|tek_color|temporary|tetra_clip|tetra_surface|tetra_volume|thin|threed|timegen|time_test2|tm_test|total|trace|transpose|triangulate|trigrid|triql|trired|trisol|tri_surf|truncate_lun|ts_coef|ts_diff|ts_fcast|ts_smooth|tv|tvcrs|tvlct|tvrd|tvscl|t_cvf|t_pdf|uindgen|uint|uintarr|ul64indgen|ulindgen|ulon64arr|ulonarr|ulong|ulong64|uniq|unsharp_mask|usersym|value_locate|variance|vector_field|vel|velovect|vert_t3d|voigt|voronoi|voxel_proj|wait|warp_tri|watershed|wdelete|wf_draw|where|window|wmenu|writeu|write_bmp|write_gif|write_image|write_jpeg|write_jpeg2000|write_nrif|write_pict|write_png|write_ppm|write_spr|write_srf|write_sylk|write_tiff|write_wav|write_wave|wset|wshow|wtn|xbm_edit|xdisplayfile|xdxf|xfont|xinteranimate|xloadct|xmanager|xmng_tmpl|xmtool|xobjview|xobjview_rotate|xobjview_write_image|xpalette|xpcolor|xplot3d|xregistered|xroi|xsq_test|xsurface|xvaredit|xvolume|xvolume_rotate|xvolume_write_image|xyouts|zoom|zoom_24)\b(?=[(, ])'
      scope: support.function.idl
    - match: (?i)\b(and|or|not|ge|gt|le|lt|eq|neq)\b
      scope: keyword.operator.idl
    - match: '->|\.'
      scope: punctuation.accessor.idl
    - match: '='
      scope: keyword.operator.assignment.idl
    - match: '\+|-|%|##?|\*|\/|\^|~|<|>'
      scope: keyword.operator.idl
    - include: brackets
    - include: procedure-call
  brackets:
    - match: \[
      scope: punctuation.definition.brackets.begin.idl
      push:
        - meta_scope: meta.brackets.idl
        - match: \]
          scope: punctuation.definition.brackets.end.idl
          pop: true
        - include: expressions
  procedure-call:
    - match: ','
      scope: punctuation.separator.idl
      push:
        - meta_scope: meta.function-call.idl
        - match: '(?<!\$)\s*$\n?'
          pop: true
        - match: '\$'
          scope: punctuation.line-continuation.idl
        - include: expressions
